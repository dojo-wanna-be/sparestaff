<div class="listing-preview-section">
  <div class="inner-preveiw">
    <div class="left-preview-detail">
      <div class="link-box">
        <%#= link_to '&lt; Back' %>
        <!-- <a href="#" class="link-text">&lt; Back</a> -->
        <ul class="link-box-list">
          <li class="link-box-item"><%= link_to 'Overview','JavaScript:Void(0);', class: 'type-link selected-link overview' %> <span class="dot">路</span></li>
          <li class="link-box-item"><%= link_to 'Asking wage', 'JavaScript:Void(0);', class: 'type-link askingWage' %> <span class="dot">路</span> </li>
          <li class="link-box-item"><%= link_to 'Availability', 'JavaScript:Void(0);', class: 'type-link availability' %> <span class="dot">路</span> </li>
          <li class="link-box-item"><%= link_to 'Reviews', 'JavaScript:Void(0);', class: 'type-link reviews' %> <span class="dot">路</span> </li>
          <li class="link-box-item"><%= link_to 'Poster', 'JavaScript:Void(0);', class: 'type-link poster' %> </li>
        </ul>
      </div>

      <div class="user-profile">
        <div class="user-detail">
          <h1 class="user-detail-heading"><%= @employee_listing.title %></h1>

          <ul class="detail-list">
            <li class="item">
              <div class="left-heading name"><b>Name</b></div>
              <div class="name right-content"><%= "#{@employee_listing.first_name} #{@employee_listing.last_name}" %></div>
            </li>
            <li class="item">
              <div class="left-heading "><b>Posted By</b></div>
              <div class="right-content"><%= @employee_listing.poster_name %></div>
            </li>
            <li class="item">
              <div class="left-heading"><b>Age</b></div>
              <div class="right-content"><%= @employee_listing.birth_year.present? ? "#{(Date.today.year - @employee_listing.birth_year)} years old" : "-" %></div>
            </li>
            <li class="item">
              <div class="left-heading"><b>Gender</b></div>
              <div class="right-content"><%= @employee_listing.gender.titleize %></div>
            </li>
            <li class="item">
              <div class="left-heading"><b>Location</b></div>
              <div class="right-content"><%= "#{@employee_listing.city} #{@employee_listing.state} #{@employee_listing.post_code}" %></div>
            </li>
            <li class="item">
              <div class="left-heading"><b>Residency</b></div>
              <div class="right-content"><%= @employee_listing.residency_status.eql?("Other Visas") ? @employee_listing.other_residency_status : @employee_listing.residency_status %></div>
            </li>
            <li class="item">
              <div class="left-heading"><b>Have own vehicle</b></div>
              <div class="right-content"><%= @employee_listing.has_vehicle ? "Yes" : "No" %></div>
            </li>
            <li class="item">
              <div class="left-heading"><b>Language</b></div>
              <div class="right-content"><%= @employee_listing.languages.pluck(:language).to_sentence %></div>
            </li>
          </ul>
        </div>
        <div class="profile-box">
          <div class="profile">
            <% if @employee_listing.profile_picture.present? %>
              <%= image_tag @employee_listing.profile_picture.url, onclick: 'openModal();currentSlide(1)', class: 'profile-img' %>
            <% else %>
              <%= image_tag 'no-image.jpg', onclick: 'openModal();currentSlide(1)', class: 'profile-img' %>
            <% end %>

            <div class="view-photo" >
              <%= link_to 'View photos', 'javascript:;', onclick: 'openModal();currentSlide(1)', class: 'view' %>
            </div>
          </div>
        </div>
      </div>

      <div class="detail-custom-box">
        <h3 class="detail-heading">Description, expertise, experience</h3>
        <p class="pera-text more" data-max-character="600"><%= @employee_listing.skill_description %></p>
      </div>

      <div class="detail-custom-box">
        <h3 class="detail-heading">Skills</h3>
        <p>
          <% @skills.each do |skill|%>
            <span class="skills-list"><%= skill.skill_name %></span>
          <% end %>
        </p>
      </div>

      <div class="detail-custom-box">
        <h3 class="detail-heading">Other comments</h3>
        <p class="pera-text more" data-max-character="200"><%= @employee_listing.optional_comments.present? ? @employee_listing.optional_comments : "-" %></p>
      </div>

      <div class="detail-custom-box">
        <h3 class="detail-heading">Cancellation policy</h3>
        <div>
          Cancel hiring before or on Start Date to get a full refund.<br/>
          Cancel after Start Date and get refund for the day of cancellation plus remaining days that you've paid for.
        </div>
      </div>

      <div class="detail-custom-box">
        <h3 class="detail-heading" id="AskingWage">Asking wage</h3>
        <ul class="custom-list">
          <li class="list-item">
            <span class="first">Weekday</span>
            <span><%= "$#{@employee_listing.weekday_price}/hour" %></span>
          </li>
          <li class="list-item">
            <span class="first">Weekend</span>
            <span><%= @employee_listing.weekend_price.present? ? "$#{@employee_listing.weekend_price}/hour" : "Not Available" %></span>
          </li>
          <li class="list-item">
            <span class="first">Public holiday</span>
            <span><%= @employee_listing.available_in_holidays ? "$#{@employee_listing.holiday_price}/hour" : "Not Available" %></span>
          </li>
        </ul>
      </div>

      <div class="detail-custom-box">
        <h3 class="detail-heading" id="Availability">Availability</h3>
        <p>Available for <%= @slots%> roles.</p>

        <ul class="custom-list">
          <% ListingAvailability::DAYS.map{|k,v| v}.each do |week_day| %>
            <li class="list-item">
              <span class="first"><%= week_day.titleize %></span>
              <span class="right">
                <% availability = @avalibilities.find_by(day: week_day) %>
                <% if availability.present? && availability.start_time.present? && availability.end_time.present? %>
                  <%= availability.start_time.strftime("%I:%M%p") %>&nbsp; -&nbsp;
                  <%= availability.end_time.strftime("%I:%M%p") %>
                <% else %>
                  Not Available
                <% end %>
              </span>
            </li>
          <% end %>

          <li class="list-item top-space">
            <span class="first">Public holiday</span>
            <span><%= @employee_listing.available_in_holidays ? "Available" : "Not available" %></span>
          </li>
        </ul>
      </div>

      <div class="detail-custom-box">
        <h3 class="detail-heading">Minimum employment term (per week)</h3>
        <ul class="custom-list">
          <li class="list-item">
            <span class="first">Minimum</span>
            <span><%= @employee_listing.minimum_working_hours %> hours</span>
          </li>
        </ul>
      </div>

      <div class="detail-custom-box">
        <div class="review-box" id="Reviews">
          <div class="review-header">
            <div class="review-count">
              <%= @reviews_all.count %> Reviews&nbsp;
              <div class="reviews_all_star_profile" data-score ="<%= @reviews_all_star.round(0) %>"></div>
              <%#= image_tag 'star-rating.png', class: 'review-img' %>
            </div>
            <div class="search-review">
               <input name="Text1" type="text" placeholder="Search reviews" class="custom-input" />
            </div>
          </div>

          <ul class="review-list">
           <li class="review-item">
             <div class="left-review">
              <div class="text-review">
                Friendliness
              </div>
              <div class="listing_star_rating" data-score ="<%= @friendliness_grade.round(0) %>"></div>
              <%#= image_tag 'star-rating.png', class: 'review-img' %>
             </div>
             <div class="right-review">
              <div class="text-review">
                Technical skills
              </div>
              <div class="listing_star_rating" data-score ="<%= @knowledge_n_skills_grade.round(0) %>"></div>
              <%#= image_tag 'star-rating.png', class: 'review-img' %>
             </div>
           </li>

           <li class="review-item">
             <div class="left-review">
              <div class="text-review">
                Punctuality
              </div>
              <div class="listing_star_rating" data-score ="<%= @punctuality_grade.round(0) %>"></div>
              <%#= image_tag 'star-rating.png', class: 'review-img' %>
             </div>
             <div class="right-review">
              <div class="text-review">
                Management skills
              </div>
              <div class="listing_star_rating" data-score ="<%= @management_skill_grade.round(0) %>"></div>
              <%#= image_tag 'star-rating.png', class: 'review-img' %>
             </div>
           </li>

           <li class="review-item">
             <div class="left-review">
              <div class="text-review">
                Professionalism
              </div>
              <div class="listing_star_rating" data-score ="<%= @professionalism_grade.round(0) %>"></div>
              <%#= image_tag 'star-rating.png', class: 'review-img' %>
             </div>
             <div class="right-review">
              <div class="text-review">
                Communication
              </div>
              <div class="listing_star_rating" data-score ="<%= @communication_grade.round(0) %>"></div>
              <%#= image_tag 'star-rating.png', class: 'review-img' %>
             </div>
           </li>

          </ul>
          <div class="sort_paginate_ajax123">
            <%= render "reviews" %>
          </div>
          <div class="poster-box" id="Poster">
            <div class="poster-detail">
              <div class="left-detail">
                <h2 class="poster-heading">Listed by <%= @employee_listing.lister_type.eql?("User") ? @employee_listing.lister.name : @employee_listing.lister.creator.name %></h2>
                <div><%= @employee_listing.poster.location %> Joined in <%= @employee_listing.poster.created_at.strftime("%B, %Y") %></div>

                <div class="both-box">
                  <div class="review">
                    <div class="review-btn"><%= @poster_reviews.count %></div>
                    Reviews
                  </div>
                  <div class="verfied">
                    <%= image_tag 'verified.png', class: 'verify-img' %>
                    Verified
                  </div>
                </div>

              </div>

              <div class="right-img">
                <%= link_to user_path(@employee_listing.poster.id), target: '_blank' do %>
                  <%= image_tag @employee_listing.poster.avatar.url, class: 'poster-img' %>
                <% end %>
              </div>
            </div>
            <p class="poster-text more" data-max-character="350"><%= @employee_listing.poster.description %></p>
            <% if current_user.present? %>
              <% if !@employee_listing.poster.eql?(current_user) %>
                <%= link_to 'Contact Poster', inbox_path(@employee_listing.id, from: 'contact'), target: '_blank', class: 'poster-btn' %>
              <% end %>
            <% else %>
              <%= link_to 'Contact Poster', inbox_path(@employee_listing.id, from: 'contact'), target: '_blank', class: 'poster-btn' %>
            <% end %>
          </div>

          <!-- <div class="page-tabbing">
            <ul class="page-tabbing-list">
              <li class="tabbing-item"><a href="" class="tabbing-link">&lt;</a></li>
              <li class="tabbing-item"><a href="" class="tabbing-link tab-select">1</a></li>
              <li class="tabbing-item"><a href="" class="tabbing-link gray-border">2</a></li>
              <li class="tabbing-item"><a href="" class="tabbing-link gray-border">3</a></li>
              <li class="tabbing-item"><a href="" class="tabbing-link gray-border">4</a></li>
              <li class="tabbing-item"><a href="" class="tabbing-link">&gt;</a></li>
            </ul>
          </div> -->

          <div class="normal-text-box">
            <p><b>Always communicate through Spare Staff</b> 路 To protect your payment, never transfer money or communicate outside of the Spare Staff website or app.
            <span><%= link_to 'Learn more', 'https://www.sparestaff.com.au/trust-and-safety', target: '_blank', class: 'learn-more' %></span>
            </p>
          </div>

        </div>
      </div>

    </div>

    <% unless current_user && current_user == @employee_listing.poster %>
      <div id="booking_slots">
        <%= render partial: "time_slot_booking", locals: {transaction: @transaction,
                                                          employee_listing: @employee_listing,
                                                          start_date: @start_date,
                                                          end_date: @end_date
                                                          } %>
      </div>
    <% end %>
  </div>

  <div class="featured-listings-box">
    <h1 class="featured-heading">Similar Listing</h1>

    <div class="featured-listings" >
      <% if @employee_listing.classification.present? %>
        <% if !@similar_nearby_listings.blank? %>
          <% @similar_nearby_listings.each_with_index do |listing, index| %>
            <%= link_to employee_path(id: listing.id), target: '_blank', class: 'licting-card-link' do %>
              <div class="listing-card">
                <div class="listing-img">
                  <% if listing.profile_picture.present? %>
                    <%= image_tag listing.profile_picture.url, class: 'card-image' %>
                  <% else %>
                    <%= image_tag 'no-image.jpg', class: 'card-image' %>
                  <% end %>
                </div>
                <div class="listing-details">
                  <div><b><%= listing.title %></b></div>
                  <div><%= listing.name %></div>
                  <div><%= "$#{listing.weekday_price} per hour" %></div>
                  <div><%= "#{listing.city.titleize} #{listing.state} #{listing.post_code}" %></div>
                  <% if params[:commit] == "Search" %>
                    <% if params[:location].present? %>
                      <div class="distance_search"><%= distance_form_search(listing.id).round(2) %> km from <%= params[:location]%></div>
                    <% end %>
                  <% end %>
                  <div class="rating">
                    <% if listing_all_reviews(listing.id).count > 0 %>
                      <span class="listing_star_rating" data-score ="<%= listing_star_rating(listing.id).round(0) %>"></span>
                      <%#= image_tag "star-rating.png", alt: "", class: "rating-img" %>
                      <span><%= listing_all_reviews(listing.id).count %></span>
                    <% else %>
                      <span>No reviews yet</span>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <div class="No results">There is no similar listings.</div>
        <% end %>
      <% end %>
    </div>

    <div class="featured-listings" style="display: none;">

      <%= link_to 'employee-search/employee-profile.html', target: '_blank', class: 'licting-card-link' do %>
        <div class="listing-card">
          <div class="listing-img">
            <%= image_tag "IT-tech-1.jpg", alt: "", class: "card-image" %>
          </div>
          <div class="listing-details">
            <div><b>IT Administrator</b></div>
            <div>Lionel Messi</div>
            <div>$25 per hour</div>
            <div>Sydney NSW 2000</div>
            <div class="rating">
              <%= image_tag "star-rating.png", alt: "", class: "rating-img" %>
              <span>35</span>
            </div>
          </div>
        </div>
      <% end %>

      <%= link_to 'employee-search/employee-profile.html', target: '_blank', class: 'licting-card-link' do %>
        <div class="listing-card">
          <div class="listing-img">
            <%= image_tag "professional-4.png", alt: "", class: "card-image" %>
          </div>
          <div class="listing-details">
            <div><b>IT System Admin</b></div>
            <div>Wayne Rooney</div>
            <div>$25 per hour</div>
            <div>Sydney NSW 2000</div>
            <div class="rating">
              <%= image_tag "star-rating.png", alt: "", class: "rating-img" %>
              <span>12</span>
            </div>
          </div>
        </div>
      <% end %>

      <%= link_to 'employee-search/employee-profile.html', target: '_blank', class: 'licting-card-link' do %>
        <div class="listing-card">
          <div class="listing-img">
            <%= image_tag "luca.png", alt: "", class: "card-image" %>
          </div>
          <div class="listing-details">
            <div><b>IT Admin Technician</b></div>
            <div>Zlatan Ibrahimovic</div>
            <div>$20 per hour</div>
            <div>North Sydney NSW 2060</div>
            <div class="rating">
              <%#= image_tag "star-rating.png", alt: "", class: "rating-img" %>
              <span>No reviews yet</span>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

</div>
<%= render partial: "layouts/footer" %>

<%= render partial: "image_lightbox_modal" %>

<script>
  $('.askingWage').click(function(e) {
    e.preventDefault();
    $('.type-link').removeClass('selected-link');
    $('.askingWage').addClass('selected-link');
    $('html, body').animate({
    scrollTop: $("#AskingWage").offset().top - 60},
      'slow');
  });

  $('.availability').click(function(e) {
    e.preventDefault();
    $('.type-link').removeClass('selected-link');
    $('.availability').addClass('selected-link');
    $('html, body').animate({
      scrollTop: $("#Availability").offset().top - 60},
        'slow');
  });

  $('.overview').click(function(e) {
    e.preventDefault();
    $('.type-link').removeClass('selected-link');
    $('.overview').addClass('selected-link');
    $('html, body').animate({
    scrollTop: $("#Overview").offset().top - 60},
      'slow');
  });

  $('.reviews').click(function(e) {
    e.preventDefault();
    $('.type-link').removeClass('selected-link');
    $('.reviews').addClass('selected-link');
    $('html, body').animate({
    scrollTop: $("#Reviews").offset().top - 60},
      'slow');
  });

  $('.poster').click(function(e) {
    e.preventDefault();
    $('.type-link').removeClass('selected-link');
    $('.poster').addClass('selected-link');
    $('html, body').animate({
    scrollTop: $("#Poster").offset().top - 60},
      'slow');
  });

  $('.listing_star_rating').raty({
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    },
    starOn: 'https://i.ibb.co/XJBTTTK/star-on.png',
    starOff:  'https://i.ibb.co/HhTx9dL/star-off.png'  
  });
</script>
